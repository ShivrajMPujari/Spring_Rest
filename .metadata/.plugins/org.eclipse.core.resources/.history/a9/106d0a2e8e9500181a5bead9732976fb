package com.bridgeIt.restDemo.config;

import java.io.IOException;
import java.util.concurrent.TimeoutException;

import org.springframework.amqp.core.Binding;
import org.springframework.amqp.core.BindingBuilder;
import org.springframework.amqp.core.Queue;
import org.springframework.amqp.core.TopicExchange;
import org.springframework.amqp.rabbit.connection.CachingConnectionFactory;
import org.springframework.amqp.rabbit.connection.ConnectionFactory;
import org.springframework.amqp.rabbit.connection.LocalizedQueueConnectionFactory;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;
import org.springframework.web.servlet.view.InternalResourceViewResolver;
import org.springframework.web.servlet.view.JstlView;

import com.bridgeIt.restDemo.model.Receiver;


@EnableWebMvc
@ComponentScan("com.bridgeIt.restDemo")
@Configuration
public class SpringConfig extends WebMvcConfigurerAdapter {

/*	@Bean
	public InternalResourceViewResolver internalViewResolver () {
		
		  InternalResourceViewResolver resolver = new InternalResourceViewResolver();
		  resolver.setViewClass(JstlView.class);
		  resolver.setPrefix("/WEB-INF/views/");
		  resolver.setSuffix(".jsp");
		
		  return resolver;
	}*/
	
	
	static final String queueName="myQueue";
	static final String topicName="myTopic";
	
	
	 
/*	 @Bean 
	ConnectionFactory factory(){
		 ConnectionFactory factory = new ConnectionFactory();
		factory.setUsername("guest");
		factory.setPassword("guest");
		factory.setHost("localhost");
		factory.setPort(5672);
		
		return null;
		
	 }*/
	
	ConnectionFactory factory;
	
	
	ConnectionFactory factory(){
		CachingConnectionFactory connectionFactory = new CachingConnectionFactory("localhost");
		connectionFactory.setUsername("guest");
		connectionFactory.setPassword("guest");
		connectionFactory.setPort(5672);
		
		return connectionFactory;
		
	 }
	
	
	
	@Bean
	Queue queue() {
		
		
	 return new Queue(queueName, true);
	}
	
	@Bean
	TopicExchange topicExchange() {
		
		return new TopicExchange(topicName);
	}
	
	@Bean
	Binding binding (Queue queue , TopicExchange topicExchange) {
		
		
		return BindingBuilder.bind(queue).to(topicExchange).with("myBindingKey");
	}
	
	
	  @Bean
	    MessageListenerAdapter listenerAdapter(Receiver receiver) {
	        return new MessageListenerAdapter(receiver, "receiveMessage");
	    }
	
	@Bean
	RabbitTemplate getTemplate () {
		
		 RabbitTemplate r = new RabbitTemplate();
		 r.setExchange(topicName);
		 r.setQueue(queueName);
		 r.setRoutingKey("myBindingKey");

		
		return r;
	}
	
	  
	  
	@Override
	public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
		
		configurer.enable();
	}
	
	
}
